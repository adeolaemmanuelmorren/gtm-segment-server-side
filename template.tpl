___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Segment.com by weNav Data",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "This template enables you to send your data to a segment.com server side HTTP source!",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "writeKey",
    "displayName": "Segment Source Write Key",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "callType",
    "displayName": "API Call Type",
    "selectItems": [
      {
        "value": "track",
        "displayValue": "Track"
      },
      {
        "value": "identify",
        "displayValue": "Identify"
      },
      {
        "value": "page",
        "displayValue": "Page"
      },
      {
        "value": "group",
        "displayValue": "Group"
      }
    ],
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "the type of segment call you want to use ( page, identify, track)"
  },
  {
    "type": "GROUP",
    "name": "eventPropertiesGroup",
    "displayName": "Event Properties",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "eventName",
        "displayName": "Event Name",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "eventPropertiesObject",
        "displayName": "Event Properties",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "Not Set",
        "help": "Use this field if you already have an object of event properties with key value pairs that you want to have unnested"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "eventPropertiesKeyValues",
        "displayName": "Additional Properties / Override Properties Object",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "propertyName",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "propertyValue",
            "type": "TEXT"
          }
        ],
        "help": "Use this to either set properties or to override properties in the object you have selected"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "callType",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "pagePropertiesGroup",
    "displayName": "Page Properties",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "pagePropertiesObject",
        "displayName": "Page Properties",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "Not Set",
        "help": "Use this field if you already have an object of event properties with key value pairs that you want to have unnested"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "pagePropertiesKeyValues",
        "displayName": "Additional Properties / Override Properties Object",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "propertyName",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "propertyValue",
            "type": "TEXT"
          }
        ],
        "help": "Use this to either set properties or to override properties in the object you have selected"
      },
      {
        "type": "TEXT",
        "name": "pageName",
        "displayName": "Page Name",
        "simpleValueType": true
      }
    ],
    "enablingConditions": [
      {
        "paramName": "callType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "groupIdentificationGroup",
    "displayName": "Group Identification \u0026 Traits",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "groupId",
        "displayName": "Group ID",
        "simpleValueType": true,
        "help": "",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "groupTraitsObject",
        "displayName": "Group Traits Object",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "Not Set",
        "help": "Use this if you already have an object containing your traits in key value pairs"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "groupTraitsKeyValues",
        "displayName": "Additional Traits / Override Traits Object",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Trait Name",
            "name": "traitName",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Trait Value",
            "name": "traitValue",
            "type": "TEXT"
          }
        ],
        "help": "Use this to either set traits or to override trits in the object you have selected"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "callType",
        "paramValue": "group",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "userIdentificationGroup",
    "displayName": "User Identification \u0026 Traits",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "userId",
        "displayName": "User ID",
        "simpleValueType": true,
        "help": "At the minimum one of userId/ anonymousId MUST be set"
      },
      {
        "type": "TEXT",
        "name": "anonymousId",
        "displayName": "Anonymous ID",
        "simpleValueType": true,
        "help": "At the minimum one of userId/ anonymousId MUST be set",
        "valueValidators": []
      },
      {
        "type": "LABEL",
        "name": "userTraitsExplanation",
        "displayName": "User Traits are set as part of the identify call, but can also be set with the track and page calls in which case they will be placed under the context object as recommended by Segment."
      },
      {
        "type": "SELECT",
        "name": "userTraitsObject",
        "displayName": "User Traits Object",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "Not Set",
        "help": "Use this if you already have an object containing your traits in key value pairs"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "userTraitsKeyValues",
        "displayName": "Additional Traits / Override Traits Object",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Trait Name",
            "name": "traitName",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Trait Value",
            "name": "traitValue",
            "type": "TEXT"
          }
        ],
        "help": "Use this to either set traits or to override trits in the object you have selected"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "contextGroup",
    "displayName": "Context Properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "LABEL",
        "name": "contextLabel",
        "displayName": "Context is a dictionary of extra information that provides useful context. On client side libraries this will often include fields that are added by default such as IP, page, campaign, locale and other useful information. Becuase this is a server side context, these are not automatically added and so therefore you can include them here. NOTE: Traits are set under user identification. Don\u0027t add them here."
      },
      {
        "type": "SELECT",
        "name": "contextPropertiesObject",
        "displayName": "",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "Not Set",
        "help": "Use this field if you have an object of context properties with key value pairs that you want to have unnested under this context object"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "contextPropertiesKeyValues",
        "displayName": "Additional Properties / Override Properties Object",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Context Property Name",
            "name": "propertyName",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Context Property Value",
            "name": "propertyValue",
            "type": "TEXT"
          }
        ],
        "help": "Use this to either set properties or to override properties in the object you have selected"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "overrideDefaultGroup",
    "displayName": "Override Default Values (Advanced)",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "overrideMessageId",
        "displayName": "Override Message ID",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "overrideTimestamp",
        "displayName": "Override Timestamp",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "integrations",
    "displayName": "Integrations",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "LABEL",
        "name": "integrationsLabel",
        "displayName": "A dictionary of destination names that the message should be sent to. \u0027All\u0027 is a special key that applies when no key for a specific destination is found. By default \u0027All\u0027 is set to true, and Salesforce is set to false. Sending data to the rest of Segment’s destinations is opt-out so if you don’t specify the destination as false in this object, it will be sent to rest of the destinations that can accept it. Source: segment documentation."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "integrationKeyValues",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Integration Name (Title Case)",
            "name": "integrationName",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Integration Value (use true or false)",
            "name": "integrationValue",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "REGEX",
                "args": [
                  "^(true|false)$"
                ],
                "errorMessage": "This value can only be set to true or false"
              }
            ]
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require('sendHttpRequest');
const makeTableMap = require('makeTableMap');
const getRequestHeader = require('getRequestHeader');
const logToConsole = require('logToConsole');
const getContainerVersion = require('getContainerVersion');
const JSON = require('JSON');
const containerVersion = getContainerVersion();
const isDebug = containerVersion.debugMode;
const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = getRequestHeader('trace-id');
const toBase64 = require('toBase64');
const Object = require("Object");
const base64WriteKey = toBase64(data.writeKey + ':');

const postHeaders = {
  'Content-Type': 'application/json',
  Authorization: 'Basic ' + base64WriteKey
};

var postBodyData = {};

function mergeObjects() {
  let obj = {},
      i = 0,
      il = arguments.length,
      key;
  for (; i < il; i++) {
    for (key in arguments[i]) {
      if (arguments[i].hasOwnProperty(key) && key.trim() !== "") {
        obj[key] = arguments[i][key];
      }
    }
  }
  return obj;
}

// Validate timestamp
postBodyData.timestamp = data.overrideTimestamp;

// Add anonymousId or userId
if (data.anonymousId) {
  postBodyData.anonymousId = data.anonymousId;
}

if (data.userId) {
  postBodyData.userId = data.userId;
}

if (data.overrideMessageId) {
  postBodyData.messageId = data.overrideMessageId;
}

const userTraits = (data.userTraitsKeyValues && Object.keys(data.userTraitsKeyValues).length !== 0) ? makeTableMap(data.userTraitsKeyValues, 'traitName', 'traitValue')
  : {};
const contextProperties = (data.contextPropertiesKeyValues && Object.keys(data.contextPropertiesKeyValues).length !== 0) ? makeTableMap(data.contextPropertiesKeyValues, 'propertyName', 'propertyValue') 
  : {};


postBodyData = mergeObjects(postBodyData, {
  context: mergeObjects({}, data.contextPropertiesObject || {}, contextProperties, {
    traits: mergeObjects({}, data.userTraitsObject || {}, userTraits)
  })
});

switch (data.callType) {
  case 'track':
    handleTrackCall();
    break;
  case 'page':
    handlePageCall();
    break;
  case 'group':
    handleGroupCall();
    break;
  case 'identify':
    postBodyData = mergeObjects(postBodyData, {
      traits: mergeObjects({}, data.userTraitsObject, userTraits)
    });
    break;
  default:
    break;
}

const postBody = JSON.stringify(postBodyData);
const requestOptions = { headers: postHeaders, method: 'POST' };

if (isLoggingEnabled) {
  logRequest('Request', postBodyData);
}

sendHttpRequest(
  'https://api.segment.io/v1/' + data.callType,
  function(statusCode, headers, body) {
    if (isLoggingEnabled) {
      logRequest('Response', { statusCode: statusCode, headers: headers, body: body });
    }

    if (statusCode >= 200 && statusCode < 300) {
      data.gtmOnSuccess();
    } else {
      data.gtmOnFailure();
    }
  },
  requestOptions,
  postBody
);

function determinateIsLoggingEnabled() {
  return data.logType === 'always' || (data.logType === 'debug' && isDebug) || (!data.logType && isDebug);
}

function logRequest(type, bodyData) {
  logToConsole(JSON.stringify({
    Name: 'JsonRequest',
    Type: type,
    TraceId: traceId,
    RequestMethod: 'POST',
    RequestUrl: 'https://api.segment.io/v1/' + data.callType,
    RequestBody: bodyData
  }));
}

function handleTrackCall() {
const eventProperties = (data.eventPropertiesKeyValues && Object.keys(data.eventPropertiesKeyValues).length !== 0) ? makeTableMap(data.eventPropertiesKeyValues, 'propertyName', 'propertyValue')
  : {};
  postBodyData.event = data.eventName;
  postBodyData = mergeObjects(postBodyData, {
    properties: mergeObjects({}, data.eventPropertiesObject, eventProperties)
  });
}

function handlePageCall() {
const pageProperties = (data.pagePropertiesKeyValues && Object.keys(data.pagePropertiesKeyValues).length !== 0) ? makeTableMap(data.pagePropertiesKeyValues, 'propertyName', 'propertyValue')
  : {};
  if (data.pageName) {
    postBodyData.name = data.pageName;
  }
  postBodyData = mergeObjects(postBodyData, {
    properties: mergeObjects({}, data.pagePropertiesObject, pageProperties)
  });
}

function handleGroupCall() {
const groupTraits = (data.groupTraitsKeyValues && Object.keys(data.groupTraitsKeyValues).length !== 0) ? makeTableMap(data.groupTraitsKeyValues, 'traitName', 'traitValue')
  : {};

  postBodyData.groupId = data.groupId;
  postBodyData = mergeObjects(postBodyData, {
    traits: mergeObjects({}, data.groupTraitsObject, groupTraits)
  });
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://api.segment.io/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/16/2023, 4:32:01 PM


